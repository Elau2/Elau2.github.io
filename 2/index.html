<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</title>
	<style>
		* {
			box-sizing: border-box;
		}
		
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 20px;
			background: #f4f4f4;
		}
		
		h1 {
			margin-top: 10%;
			margin-bottom: 20px;
			padding-right: 20%;
			padding-left: 20%;
		}

		h2 {
			margin-top: 20px;
			margin-bottom: 20px;
			padding-right: 20%;
			padding-left: 20%;
		}
		
		p.description {
			font-size: 1.2rem;
			margin-bottom: 20px;
			color: #555;
			padding-right: 20%;
			padding-left: 20%;
		}
		
		.static-image {
			text-align: center;
			margin-bottom: 30px;
			padding-right: 30%;
			padding-left: 30%;
			margin-top: 5%;
			margin-bottom: 5%;
		}
		
		.static-image img {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		
		.gallery {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			padding-right: 20%;
			padding-left: 20%;
		}
		
		.gallery-item {
			background: white;
			border-radius: 8px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			transition: transform 0.3s;
		}
		
		.gallery-item:hover {
			transform: scale(1.02);
		}
		
		.gallery-item img {
			width: 100%;
			display: block;
		}
		
		.caption {
			padding: 10px;
			font-size: 1rem;
			text-align: center;
			color: #333;
		}

		.MathJax {
			font-size: 1.2em !important;
		}
	</style>
	
	<script type="text/javascript" id="MathJax-script" async
		src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
	</script>
</head>
<body>
	
	<h1>Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</h1>
	
	
	<p class="description">
		Ethan Lau
	</p>

	<h2>Introduction</h2>

	<p class="description">
		Prokudin-Gorskii pioneered early color photography. Having travelled the Russian Empire and convinved of the future of color photogtaphy, he pictured each scene through a glass plate using a red, green, and blue filters. 
	</p>

	<h2>Methodology</h2>

	<p class="description">
		Through the sequential exposure of the same scene through red, green, and blue filters, we are able to reconstruct scenes as though it was originally taken in color. However, several challenges arose when attempting to convert the three images into a single colored image. 
	</p>
	
	<div class="static-image">
		<img src="./media/monastery-original.jpg" alt="Featured Static Image">
	</div>

	<p class="description">
		The original glass pane images were often misaligned. Therefore an alignment methology was devised. First, each of the red, green, and blue filtered images were cropped (center 80%) and normalized. The green and red channels were then aligned by determining:

		$$\underset{x_o, y_o}{\text{argmax}} \sum_{x,y} I_1(x,y)I_2(x+x_o, y+y_o)$$

		where \(x_o, y_o\) are the offsets of the green and red channel \(I_2\). The blue channel is depicted through \(I_1\). This method, also known as normalized cross correlation, worked for the vast majority of images, but was slow and did not take into account images with large differing color intensities.
	</p>
	<p class="description">
		Improvements to speed were implemented through the use of a multi-scale pyramid, where images were continuously resized until both dimensions were strictly less than 400 pixels wide. Normalized cross correlation was then implemented and propogated up over larger and lager images, doubling the offset and searching in a small area surrounding the calculated offset. This methodology allowed for a more efficent search and drastically reduced the number of normalized cross-correlation calculations needed, drastically increasing efficency over brute-force search for the maximum NCC. 
	</p>
		
	
	<h2>Challenges</h2>
	<p class="description">
		Although the majority images were  properly aligned through applying NCC on each of the color channels, some samples, as depicted below, failed to properly align using this methology. Instead of using NCC on color intensities, an approach using Sobel edge detection and using NCC alignment on those edges appeared to be more robust.
	</p>

	<div class="static-image">
		<img src="./media/emir-naive.jpg" alt="Featured Static Image">
	</div>


	<p class="description">
		Edge detection was implented using the Sobel operator, which helps detect changes in the vertical and horizontal directions respectively:

		$$G_x = 
		\begin{bmatrix}
		-1 & 0 & 1\\
		-2 & 0 & 2 \\
		-1 & 0 & 1 \\
		\end{bmatrix} * I
		$$

		$$G_y = 
		\begin{bmatrix}
		-1 & -2 & -1\\
		0 & 0 & 0 \\
		1 & 2 & 1 \\
		\end{bmatrix} * I
		$$

		$$G = \sqrt{G_x^2 + G_y^2}$$

		where \(*\) is the convolutional operator and \(I\) is the image. The magnitude of the edge was determined using horizontal and vertical magnitudes of the edge detector. NCC alignment was then performed on the edge detected image. While gaussian blur is typically applied prior to the Sobel filter (in order to reduce high frequency noise), blurring did not improve the effectiveness of the algorithm on these select images. The improved result is depicted below:
	</p>

	<div class="static-image">
		<img src="./media/emir.jpg" alt="Featured Static Image">
	</div>

	

	<h2>Final Results</h2>

	<p class="description">
		The following images were produced using NCC alignment on images. The displacement of the red and green channels are depicted in the caption.
	</p>
	
	<div class="gallery">
		<div class="gallery-item">
			<img src="./media2/cathedral.jpg" alt="Sample 1">
			<div class="caption">R: (3, 12) G: (2, 5)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/church.jpg" alt="Sample 2">
			<div class="caption">R: (-4, 58) G: (4, 25)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/emir.jpg" alt="Sample 3">
			<div class="caption">R: (-205, 141) G: (24, 49)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/harvesters.jpg" alt="Sample 1">
			<div class="caption">R: (13, 124) G: (17, 60)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/icon.jpg" alt="Sample 2">
			<div class="caption">R: (23, 89) G: (17, 41)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/italil.jpg" alt="Sample 3">
			<div class="caption">R: (35, 76) G: (21, 38)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/lastochikino.jpg" alt="Sample 1">
			<div class="caption">R: (-9, 75) G: (-2, -3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/lugano.jpg" alt="Sample 2">
			<div class="caption">R: (-29, 93) G: (-16, 41)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/melons.jpg" alt="Sample 3">
			<div class="caption">R: (13, 178) G: (11, 82)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/monastery.jpg" alt="Sample 1">
			<div class="caption">R: (2, 3) G: (2, -3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/self_portrait.jpg" alt="Sample 2">
			<div class="caption">R: (37, 176) G: (29, 79)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/siren.jpg" alt="Sample 3">
			<div class="caption">R: (-25, 96) G: (-6, 49)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/three_generations.jpg" alt="Sample 2">
			<div class="caption">R: (11, 112) G: (14, 53)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/tobolsk.jpg" alt="Sample 3">
			<div class="caption">R: (3, 6) G: (3, 3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/books.jpg" alt="Sample 3">
			<div class="caption">R: (-5, 124) G: (7, 52)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/building.jpg" alt="Sample 2">
			<div class="caption">R: (11, 125) G: (7, 45)</div>
		</div>
		<div class="gallery-item">
			<img src="./media2/trees.jpg" alt="Sample 3">
			<div class="caption">R: (7, 97) G: (-32, 37)</div>
		</div>
	</div>

	<p class="description">
		The following images were produced using NCC alignment on images put through a Sobel edge detector. The displacement of the red and green channels are depicted in the caption.
	</p>
	
	<div class="gallery">
		<div class="gallery-item">
			<img src="./media/cathedral.jpg" alt="Sample 1">
			<div class="caption">R: (3, 12) G: (2, 5)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/church.jpg" alt="Sample 2">
			<div class="caption">R: (-4, 58) G: (4, 25)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/emir.jpg" alt="Sample 3">
			<div class="caption">R: (40, 107) G: (24, 49)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/harvesters.jpg" alt="Sample 1">
			<div class="caption">R: (14, 124) G: (17, 60)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/icon.jpg" alt="Sample 2">
			<div class="caption">R: (23, 90) G: (17, 42)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/italil.jpg" alt="Sample 3">
			<div class="caption">R: (36, 77) G: (22, 38)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/lastochikino.jpg" alt="Sample 1">
			<div class="caption">R: (-8, 76) G: (-2, -3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/lugano.jpg" alt="Sample 2">
			<div class="caption">R: (-29, 92) G: (-17, 41)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/melons.jpg" alt="Sample 3">
			<div class="caption">R: (13, 177) G: (10, 80)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/monastery.jpg" alt="Sample 1">
			<div class="caption">R: (2, 3) G: (2, -3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/self_portrait.jpg" alt="Sample 2">
			<div class="caption">R: (37, 176) G: (29, 78)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/siren.jpg" alt="Sample 3">
			<div class="caption">R: (-24, 96) G: (-6, 49)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/three_generations.jpg" alt="Sample 2">
			<div class="caption">R: (9, 111) G: (12, 54)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/tobolsk.jpg" alt="Sample 3">
			<div class="caption">R: (3, 6) G: (3, 3)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/books.jpg" alt="Sample 3">
			<div class="caption">R: (-5, 124) G: (7, 52)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/building.jpg" alt="Sample 2">
			<div class="caption">R: (11, 125) G: (7, 45)</div>
		</div>
		<div class="gallery-item">
			<img src="./media/trees.jpg" alt="Sample 3">
			<div class="caption">R: (7, 97) G: (-32, 37)</div>
		</div>
		
		<!-- Add more gallery-item divs as needed -->
	</div>
	
</body>
</html>